<mvc:View controllerName="com.viatris.materialmaster.controller.Repository"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:main="sap.ui.webc.main"
    xmlns:table="sap.ui.table"
    xmlns:f="sap.f"
    xmlns:tnt="sap.tnt"
    xmlns:fb="sap.ui.comp.filterbar">
    <Page showHeader="true" enableScrolling="true" class="MM_Page">
        <customHeader>
            <Bar>
                <contentLeft>
                    <Title text="{i18n>repository}" class="MM_Title" level="H4" titleStyle="H4"></Title>
                </contentLeft>
                <contentRight>
                    <Button text="{i18n>downloadRepositoryData}" type="Emphasized" class="MM_BtnEmphasized" press="onPressDownloadRqpositoryData"></Button>
                    <Button text="{i18n>downloadAuditLog}" type="Emphasized" class="MM_BtnEmphasized" press="onOpenDownloadAuditLog" />
                </contentRight>
            </Bar>
        </customHeader>
        <content>

            <VBox >
                <Panel expandable="true" expanded="true" width="auto" headerText="{i18n>filter}" class="MM_panel sapUiTinyMargin">
                    <headerToolbar>
                        <OverflowToolbar style="Clear" class="MM_panelHeader_toolBar">
                            <main:Icon class="sapUiTinyMargin" name="sap-icon://filter" />
                            <Title text="{i18n>filter}" />
                            <ToolbarSpacer />
                        </OverflowToolbar>
                    </headerToolbar>
                    <content>
                        <l:Grid defaultSpan="XL3 L3 M6 S6" hSpacing="2" class="sapUiTinyMarginBeginEnd" binding="{Repository>/FilterOptions/BasicFilter}">
                            <VBox>
                                <Label text="{i18n>materialNumber}" class="MM_Label" />
                                <Input value="{Repository>materialNumber}" class="MM_InputText" placeholder="{i18n>searchMaterialNumber}" liveChange="ongetMaterialNumber" type="Number" autocomplete="false" showSuggestion="true" suggestionItems="{Repository>MaterialSearchHelpSet}" startSuggestion="2" maxSuggestionWidth="auto">
                                    <suggestionItems>
                                        <core:ListItem text="{Repository>materialNumber}" additionalText="{Repository>fieldDesc}"/>
                                    </suggestionItems>
                                </Input>
                            </VBox>
                            <VBox>
                                <Label text="{i18n>materialType}" class="MM_Label" />
                                <ComboBox width="100%" class="MM_ComboBox" placeholder="{i18n>selectMaterialType}" selectedKey="{Repository>materialType}" showSecondaryValues="true" filterSecondaryValues= "true" items="{LookupModel>/repoSpecificLookups/materialType}" change="fnHandleComboboxValidation">
                                    <core:ListItem key="{LookupModel>MM_KEY}" text="{LookupModel>MM_MATERIAL_TYPE_SAP_CODE} - {LookupModel>MM_MATERIAL_TYPE_DESCRIPTION}"/>
                                </ComboBox>
                            </VBox>
                            <VBox>
                                <Label text="{i18n>marketDestination}" class="MM_Label" />
                                <!-- <Input value="{Repository>marketDestination}" class="MM_InputText" placeholder="{i18n>searchmarketDestination}" /> -->
                                <MultiComboBox width="100%" class="MM_MultiComboBox" placeholder="{i18n>searchMarketDestination}" selectedKeys="{Repository>marketDestination}" showSecondaryValues="true" items="{LookupModel>/Market_Destination}">
                                    <core:ListItem key="{LookupModel>MM_KEY}" text="{LookupModel>MM_MARKET_DEST_REF_LIST_CODE} - {LookupModel>MM_MARKET_DEST_REF_LIST_DESC}"/>
                                </MultiComboBox>
                            </VBox>
                            <VBox>
                                <Label text="{i18n>globalMaterialDescription}" class="MM_Label" />
                                <Input value="{Repository>materialDescription}" class="MM_InputText" placeholder="{i18n>searchGlobalMaterialDescription}" />
                            </VBox>
                            <VBox>
                                <Label text="{i18n>livery}" class="MM_Label" />
                                <!-- <Input value="{Repository>livery}" class="MM_InputText" placeholder="{i18n>searchLivery}" /> -->
                                <ComboBox width="100%" class="MM_ComboBox" placeholder="{i18n>searchLivery}" selectedKey="{Repository>livery}" showSecondaryValues="true" items="{LookupModel>/Livery}" change="fnHandleComboboxValidation">
                                    <core:ListItem key="{LookupModel>MM_KEY}" text="{LookupModel>MM_LIVERY_REF_LIST_DESC}"/>
                                </ComboBox>
                            </VBox>
                            <VBox>
                                <Label text="{i18n>plant}" class="MM_Label" />
                                <!-- <Input value="{Repository>plant}" class="MM_InputText" placeholder="{i18n>searchPlant}" /> -->
                                <ComboBox width="100%" class="MM_ComboBox" placeholder="{i18n>searchPlant}" selectedKey="{Repository>plant}" showSecondaryValues="true" items="{LookupModel>/MM_PLANT_REF_LIST}" change="fnHandleComboboxValidation">
                                    <core:ListItem key="{LookupModel>MM_KEY}" text="{LookupModel>MM_PLANT_REF_LIST_CODE} - {LookupModel>MM_PLANT_REF_LIST_DESC}"/>
                                </ComboBox>
                            </VBox>
                            <VBox>
                                <Label text="{i18n>materialSyndicationStatus}" class="MM_Label" />
                                <ComboBox width="100%" class="MM_ComboBox" placeholder="{i18n>selectMaterialSyndicationStatus}" selectedKey="{Repository>status}" showSecondaryValues="true" items="{LookupModel>/materialStatus}" change="fnHandleComboboxValidation">
                                    <core:ListItem key="{LookupModel>MM_KEY}" text="{LookupModel>MM_MATERIAL_STATUS_DESCRIPTION}"/>
                                </ComboBox>
                            </VBox>
                            <VBox>
                                <Label text="{i18n>strength}" class="MM_Label" />
                                <Input value="{Repository>strength}" class="MM_InputText" placeholder="{i18n>searchStrength}" />
                            </VBox>
                            <VBox>
                                <Label text="{i18n>molecule}" class="MM_Label" />
                                <!-- <Input value="{Repository>molecule}" class="MM_InputText" placeholder="{i18n>searchMolecule}" /> -->
                                <ComboBox width="100%" class="MM_ComboBox" placeholder="{i18n>searchMolecule}" selectedKey="{Repository>molecule}" showSecondaryValues="true" items="{LookupModel>/Molecule}" change="fnHandleComboboxValidation">
                                    <core:ListItem key="{LookupModel>MM_KEY}" text="{LookupModel>MM_MOLECULE_REF_LIST_DESC}"/>
                                </ComboBox>
                            </VBox>
                            <VBox>
                                <Label text="" />

                            </VBox>
                            <VBox>
                                <Label text="" />

                            </VBox>
                            <HBox justifyContent="End">
                                <Label text="" class="MM_Label" />
                                <Button text="{i18n>clear}" icon="sap-icon://clear-filter" type="Default" class="MM_BtnDefault sapUiTinyMarginEnd" press="onClearFilterData" />
                                <Button text="{i18n>search}" icon="sap-icon://filter" type="Emphasized" class="MM_BtnEmphasized sapUiTinyMarginEnd" press="onRepositoryAdvanceFilter"/>
                                <Button text="{i18n>Advancesearch}" icon="sap-icon://add-filter" type="Emphasized" class="MM_BtnEmphasized" press="onOpenDynamicSearch" />
                            </HBox>


                        </l:Grid>
                    </content>
                </Panel>
            </VBox>
            <VBox class="sapUiTinyMarginBeginEnd sapUiTinyMarginBottom MM_TableContainer">
                <table:Table rows="{Repository>/MaterialsList}" visibleRowCount="{parts: ['Repository>/MaterialsList'], formatter: '.formatter.getVisibleRowCount'}" id="repositoryTableId" selectionMode="Single" class="MM_UiTable MM_UiTableCopy" rowSelectionChange="onClickRepoMaterialListitem" selectionBehavior="RowOnly">
                    <table:extension>
                        <OverflowToolbar style="Clear">
                            <Title text="Material List"/>
                            <Text emptyIndicatorMode="On" text="{Repository>/PaginationDetails/totalrecords}" class="MM_TextwithLeftBorder sapUiLargeMarginBegin"></Text>
                            <ToolbarSpacer/>
                        </OverflowToolbar>
                    </table:extension>
                    <table:columns>
                        <table:Column width="8%">
                            <Label text="{i18n>materialNumber}" wrapping="true" />
                            <table:template>
                                <Text text="{Repository>materialNumber}" wrapping="false" />
                            </table:template>
                        </table:Column>
                        <table:Column width="25%">
                            <Label text="{i18n>globalMaterialDescription}" wrapping="true"/>
                            <table:template>
                                <Text text="{Repository>materialDesc}" renderWhitespace="true"/>
                            </table:template>
                        </table:Column>
                        <table:Column width="7%" >
                            <Label text="{i18n>materialType}" wrapping="true"/>
                            <table:template>
                                <Text text="{parts:['Repository>materialTypeId', 'LookupModel>/materialType'],formatter: '.formatter.getMaterialTypetext'}"/>
                            </table:template>
                        </table:Column>
                        <table:Column width="14%">
                            <Label text="{i18n>materialSyndicationStatus}" wrapping="true"/>
                            <table:template>
                                <Text text="{parts:['Repository>materialStatusId', 'LookupModel>/materialStatus'],formatter: '.formatter.getMaterialStatusText'}"/>
                            </table:template>
                        </table:Column>
                        <table:Column>
                            <Label text="{i18n>Market_Destination}" wrapping="true" />
                            <table:template>
                                <Text text="{path:'Repository>marketDest', formatter: '.formatter.getMarketCodes'}"/>
                            </table:template>
                        </table:Column>
                        <table:Column width="10%">
                            <Label text="{i18n>Material_Lifecycle_Status}" wrapping="true" />
                            <table:template>
                                <Text text="{Repository>materialLifeCycleStatus/code}"/>
                            </table:template>
                        </table:Column>
                        <table:Column width="10%" visible="{parts : ['oAppModel>/userdetails/userRole'], formatter : '.formatter.fnVisibleRepoActionColumn'}">
                            <Label text="{i18n>action}" />
                            <table:template>
                                <OverflowToolbar class="MM_OverflowToolbar">
                                    <OverflowToolbarButton icon="sap-icon://edit" text ="{i18n>edit}" tooltip="{i18n>edit}" class="MM_OverflowBtn" press="fnEditRepoDetails" enabled="{parts: [{value: 'Modify'}, {path:'Repository>/MaterialSelected/selectedPath'}, {path:'Repository>materialNumber'}, {path:'Repository>/MaterialSelected/repoSubmitFor'}], formatter : '.formatter.fnSetEnableforRepoSelectedMLRow'}"/>
                                    <OverflowToolbarButton icon="sap-icon://add-coursebook" text ="{i18n>extend}" tooltip="{i18n>extend}" class="MM_OverflowBtn" press="fnExtendRepoDetails" enabled="{parts: [{value: 'Extend'}, {path:'Repository>/MaterialSelected/selectedPath'}, {path:'Repository>materialNumber'}, {path:'Repository>/MaterialSelected/repoSubmitFor'}], formatter : '.formatter.fnSetEnableforRepoSelectedMLRow'}"/>
                                    <OverflowToolbarButton icon="sap-icon://write-new-document" text ="{i18n>editDocument}" tooltip="{i18n>editDocument}" class="MM_OverflowBtn" press="fnEditRepoDocument" enabled="{parts: [{value: 'EditDocument'}, {path:'Repository>/MaterialSelected/selectedPath'}, {path:'Repository>materialNumber'}, {path:'Repository>/MaterialSelected/repoSubmitFor'}], formatter : '.formatter.fnSetEnableforRepoSelectedMLRow'}"/>
                                </OverflowToolbar>
                            </table:template>
                        </table:Column>
                    </table:columns>
                </table:Table>
            </VBox>
            <VBox>
                <OverflowToolbar binding="{Repository>/PaginationDetails}" visible="true">
                    <Label text="{i18n>showingPage} {Repository>currentPage} {i18n>ofText} {Repository>totalPages}" textDirection="RTL" design="Bold"/>
                    <ToolbarSpacer/>
                    <HBox renderType="Bare" alignItems="Center" class="MM_PaginationBox_HBox">
                        <Button icon="sap-icon://nav-back" enabled="{parts:['Repository>currentPage'], formatter:'.formatter.enableLeftNavButton'}" class="MM_PaginationNavButton" press="onPrevPage"/>
                        <HBox renderType="Bare" alignItems="Center" items="{Repository>totalPagesArray}">
                            <Link text="{Repository>page}" press="onPageClick" fieldGroupIds="iD_PageNumber" class="MM_PaginationLinkColor" wrapping="true"/>
                        </HBox>
                        <Button icon="sap-icon://navigation-right-arrow" enabled="{parts:['Repository>currentPage','Repository>totalPages'], formatter:'.formatter.enableRightNavButton'}" class="MM_PaginationNavButton" press="onNextPage"/>
                    </HBox>
                    <HBox class="sapUiSmallMargin">
                        <Label text="{i18n>selectRowsPerPage}" class="sapUiTinyMarginTop sapUiTinyMarginEnd"/>
                        <Select items="{Repository>possibleRowsPerPage}" selectedKey="{Repository>selectRowsPerPage}" change="onSelectPageSize">
                            <core:Item text="{Repository>key}"/>
                        </Select>
                    </HBox>
                </OverflowToolbar>
            </VBox>

            <VBox>
                <VBox visible="{Repository>/MaterialSelected/isMaterialDetailsVisible}">
                    <core:Fragment fragmentName="com.viatris.materialmaster.fragments.createProject.MaterialDetails" type="XML" />
                </VBox>
            </VBox>

        </content>
        <footer>
            <Toolbar>
                <ToolbarSpacer/>
                <Button text="{i18n>cancel}" type="Default" press="onClickRepoCancelBtn" class="MM_BtnDefault" visible="{Repository>/MaterialSelected/showRepoFooterActions}"/>
                <Button text="{i18n>submit}" type="Emphasized" press="onClickRepoSubmitBtn" class="MM_BtnEmphasized" visible="{Repository>/MaterialSelected/showRepoFooterActions}"/>
            </Toolbar>
        </footer>

    </Page>
</mvc:View>